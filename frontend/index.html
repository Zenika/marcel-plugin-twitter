<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>marcel-plugin-twitter</title>
  <script src="./marcel.js"></script>
</head>

<body>

  <div id="root"></div>

  <style>
    iframe {
      height: 100vh !important;
    }
  </style>

  <script>
    class TwitterPlugin extends Marcel.Plugin {
      constructor() {
        super()
        this.root = document.getElementById('root')
        this.initTwitterAPI()
      }

      initTwitterAPI() {
        const id = "twitter-wjs", s = "script", src = "https://platform.twitter.com/widgets.js"

        const loadAPI = () => {
          const twttr = window.twttr || {}
          if (document.getElementById(id)) return twttr

          const fjs = document.getElementsByTagName(s)[0]
          const js = document.createElement(s)

          js.id = id
          js.src = src
          fjs.parentNode.insertBefore(js, fjs)

          twttr._e = []
          twttr.ready = function (f) {
            twttr._e.push(f)
          }

          return twttr;
        }

        window.twttr = loadAPI()
      }

      displayTwitter() {
        console.log("Loading timeline : ", this.props.widgetID)
        twttr.widgets.createTimeline(
          this.props.widgetID,
          this.root,
        )
      }

      propsDidChange(prevProps) {
        if (prevProps.widgetID !== this.props.widgetID) {
          this.root.innerHTML = ""
          window.twttr.ready(() => this.displayTwitter())
        }
      }
    }

    const instance = new TwitterPlugin()
  </script>
</body>

</html>